<!DOCTYPE html>
<html lang="en">

<head>
    <title>首頁 | 買咖啡 | 購物清單</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.2.0/redux.min.js"
        integrity="sha512-1/8Tj23BRrWnKZXeBruk6wTnsMJbi/lJsk9bsRgVwb6j5q39n0A00gFjbCTaDo5l5XrPVv4DZXftrJExhRF/Ug=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./index.css">

    <script src="./js/jquery-1.11.3.min.js"></script>
    <script src="./js/jquery.jcarousellite.min.js"></script>
</head>

<body>
    <div id="root"></div>
    <div id="nav"></div>
    <script type="text/babel">

        const { useState, useEffect } = React;

        const Nav = ({ cartQuantity }) => {

            const [showOverlay, setShowOverlay] = useState(false);

            const handleClick = () => {
                setShowOverlay(!showOverlay); // 點擊時切換 showOverlay 的狀態
            };

            const handleHomeClick = () => {
                setShowOverlay(false); // 點擊 Home 時隱藏 showOverlay
            };

            return (
                <>
                    <div className={`overlay ${showOverlay ? 'show-overlay' : ''}`}>
                        <div className="nav-find"><a href="https://dorisl118.github.io/side-project-POCA/page/index.html"><p>首頁 &nbsp; | &nbsp; POCA &nbsp; ❯</p></a></div>
                        <hr />
                        <div className="nav-find"><a href="https://dorisl118.github.io/side-project-POCA/page/article.html"><p>找咖啡 &nbsp; | &nbsp; Cafe Article &nbsp; ❯</p></a></div>
                        <hr />
                        <div className="nav-buy"><a href="https://dorisl118.github.io/side-project-POCA/page/product.html"><p>買咖啡 &nbsp; | &nbsp; Coffee Shop &nbsp; ❯</p></a></div>
                        <hr />
                        <div className="nav-map"><a href="https://dorisl118.github.io/side-project-POCA/page/map.html"><p>店家地圖 &nbsp; | &nbsp; Cafe Map &nbsp; ❯</p></a></div>
                        <hr />
                        <div className="nav-map"><a href="https://dorisl118.github.io/side-project-POCA/page/contact.html"><p>聯繫我們 &nbsp; | &nbsp; Contact us &nbsp; ❯</p></a></div>
                        <hr />
                        <div className="nav-home" onClick={handleHomeClick}><p>返回 &nbsp; | &nbsp; Return &nbsp; ❯</p></div>
                        <div className="return" onClick={handleHomeClick}><img src="./icon/@1x/menu-return.svg" alt="" /></div>
                    </div>

                    <div className="article-container">
                        <div className="row row-cols-2 mt-3">
                            <div className="row-col-2" >
                                <a href="https://dorisl118.github.io/side-project-POCA/page/index.html">
                                    <img src="./logo/@1x/Header-LOGO.svg" alt="#" />
                                </a>
                            </div>
                            <div className="row-col-2" >
                                <ul className="nav justify-content-end">
                                    <li className="nav-item">
                                        <div className="nav-item-1-1">
                                            <a href="https://dorisl118.github.io/side-project-POCA/page/checkout.html">
                                                <img src="./icon/@1x/ShoppingCart.svg" alt="" />
                                            </a>
                                        </div>
                                        <div className="nav-item-1-2">{cartQuantity}</div>
                                    </li>
                                    <li className="nav-item" onClick={handleClick}>
                                        <img src="./icon/@1x/menu.svg" className="nav-link-more" href="#"></img>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </>
            );
        }

        const Checkout = () => {
            const [cartItems, setCartItems] = useState([]);
            const [showIframe, setShowIframe] = useState(false);

            useEffect(() => {
                const savedCartItems = localStorage.getItem('cartItems');
                if (savedCartItems) {
                    setCartItems(JSON.parse(savedCartItems));
                }
            }, []);

            useEffect(() => {
                if (cartItems.length === 0) {
                    setShowIframe(true);
                } else {
                    setShowIframe(false);
                }
            }, [cartItems]);

            const handleDeleteItem = (itemId) => {
                const updatedCartItems = cartItems.filter(item => item.id !== itemId);
                setCartItems(updatedCartItems);
                localStorage.setItem('cartItems', JSON.stringify(updatedCartItems));
            };

            const calculateTotalPrice = (items) => {
                return items.reduce((total, item) => {
                    return total + (item.price * item.quantity);
                }, 0);
            };

            const totalPrice = calculateTotalPrice(cartItems);

            const ShoppingCartPage = () => (
                <div className="shopping-cart-page">
                    <ul>
                        {cartItems.map(item => (
                            <li key={item.id}>
                                <div><img src={item.img} alt={item.title} /></div>
                                <div>{item.title ? <p>{item.title}</p> : null}</div>
                                <div><p>數量: {item.quantity}</p></div>
                                <div>{item.price ? <p>NT $ {item.quantity * item.price}</p> : null}</div>
                                <div><button onClick={() => handleDeleteItem(item.id)}><img src="./icon/@1x/Delete.svg" /></button></div>
                            </li>
                        ))}
                        <hr />
                        <div className="totalPrice"><p>總計: {totalPrice} 元</p></div>
                    </ul>
                </div>
            );
            const clearLocalStorage = () => {
                localStorage.removeItem('cartItems');
            };

            const Form = () => (
                <>
                    <div className="form-data">
                        <div class="vertical-line"></div>

                        <form className="smoove" action="" method="post" name="form-contact" id="form-contact" title="完成訂購表單">
                            <div>
                                <label htmlFor="username">收件姓名&nbsp;&nbsp;&nbsp;</label>
                                <input type="text" name="username" id="username" title="請輸入姓名" placeholder="請輸入姓名" required />
                            </div>
                            <div>
                                <label htmlFor="tel">聯絡電話&nbsp;&nbsp;&nbsp;</label>
                                <input type="tel" name="tel" id="tel" title="請輸入聯絡電話" placeholder="請輸入聯絡電話" required />
                            </div>
                            <div>
                                <label htmlFor="email">電子郵件&nbsp;&nbsp;&nbsp;</label>
                                <input type="email" name="email" id="email" title="請輸入電子郵件" placeholder="請輸入電子郵件" required />
                            </div>
                            <div>
                                <label htmlFor="county">運送方式&nbsp;&nbsp;&nbsp;</label>
                                <select name="county" id="county" required>
                                    <option value="選擇" disabled selected>請選擇運送方式</option>
                                    <option value="宅配">宅配</option>
                                    <option value="超商店到店">超商店到店</option>
                                </select>
                            </div>
                            <div>
                                <label htmlFor="county">收件縣市&nbsp;&nbsp;&nbsp;</label>
                                <select name="county" id="county" required>
                                    <option value="選擇" disabled selected>請選擇收件縣市</option>
                                    <option value="台北市">台北市</option>
                                    <option value="新北市">新北市</option>
                                    <option value="桃園市">桃園市</option>
                                    <option value="台中市">台中市</option>
                                    <option value="台南市">台南市</option>
                                    <option value="高雄市">高雄市</option>
                                    <option value="基隆市">基隆市</option>
                                    <option value="新竹市">新竹市</option>
                                    <option value="嘉義市">嘉義市</option>
                                    <option value="新竹縣">新竹縣</option>
                                    <option value="苗栗縣">苗栗縣</option>
                                    <option value="彰化縣">彰化縣</option>
                                    <option value="南投縣">南投縣</option>
                                    <option value="雲林縣">雲林縣</option>
                                    <option value="嘉義縣">嘉義縣</option>
                                    <option value="屏東縣">屏東縣</option>
                                    <option value="宜蘭縣">宜蘭縣</option>
                                    <option value="花蓮縣">花蓮縣</option>
                                    <option value="台東縣">台東縣</option>
                                    <option value="澎湖縣">澎湖縣</option>
                                    <option value="金門縣">金門縣</option>
                                    <option value="連江縣">連江縣</option>
                                </select>

                                <label className="zipcode" htmlFor="zipcode">郵遞區號&nbsp;&nbsp;&nbsp;</label>
                                <input type="text" name="zipcode" id="zipcode" title="請輸入郵遞區號" placeholder="請輸入郵遞區號" required />
                            </div>
                            <div className="address">
                                <label htmlFor="address">收件地址&nbsp;&nbsp;&nbsp;</label>
                                <input type="email" name="email" id="email" title="請輸入詳細收件地址" placeholder="請輸入詳細收件地址" required />
                            </div>
                            <div className="btn-form"  onClick={() => { clearLocalStorage(); }}>
                                <a href="https://dorisl118.github.io/side-project-POCA/page/shoppingComplete.html" ><span className="font-noto-sans">完成訂購 ❯</span></a>
                            </div>
                        </form>
                    </div>
                </>
            );

            const CartEmpty = () => (
                <div className="wavebox">
                    <div className="wavecontent">
                        <div>
                            <img src="./img/@1x/wave-notify-v0507.svg" alt="" />
                            <p>購物車尚未加入任何商品。</p>
                            <img src="./img/@1x/wave-notify-v0507.svg" alt="" />
                        </div>
                    </div>
                </div>
            );

            return (
                <>
                    <Nav />

                    <div className="page-title">
                        <hr />
                        <p>首頁 | 買咖啡 | 購物清單</p>
                        <hr />
                    </div>

                    <section className="form">
                        {showIframe ? <CartEmpty /> : (
                            <>
                                <ShoppingCartPage />
                                <Form />
                            </>
                        )}

                    </section>

                    <div className="footer">
                        <hr />
                        <p>© 2024 POCA. | 跑咖</p>
                    </div>
                </>
            );
        };


        ReactDOM.createRoot(document.getElementById('root')).render(<Checkout />);
        ReactDOM.createRoot(document.getElementById('nav')).render(<Nav />);

    </script>

</body>

</html>